---
import Layout from "../layouts/Layout.astro";
import EventCalendar from "../components/EventCalendar.astro";
import Navbar from "../components/Navbar.astro";

// Server-side redirect check
const cookie = Astro.request.headers.get("cookie") || "";
const hasToken = cookie.includes("token=");

if (!hasToken) {
    return Astro.redirect("/login");
}
---

<Layout title="User Dashboard - EventEase">
    <div class="flex h-screen bg-gray-50 overflow-hidden">
        <aside
            id="sidebar"
            class="fixed inset-y-0 left-0 z-50 w-80 bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 -translate-x-full shadow-lg"
        >
            <div
                class="flex items-center justify-between h-20 px-6 border-b border-gray-200 bg-gray-50"
            >
                <a
                    href="/"
                    class="text-2xl font-black text-blue-600 tracking-tight"
                    style="font-family: 'Space Grotesk', sans-serif;"
                >
                    EventEase
                </a>
                <button
                    id="closeSidebar"
                    class="lg:hidden text-gray-500 hover:text-gray-900 text-2xl font-bold"
                >
                    ✕
                </button>
            </div>

            <div class="px-6 py-6 border-b border-gray-200 bg-blue-50">
                <div class="flex items-center gap-4">
                    <div class="avatar placeholder">
                        <div
                            class="bg-blue-200 text-white w-14 h-14 shadow-lg ring-2 ring-white ring-offset-2"
                        >
                            <span
                                class="text-lg font-bold"
                                style="font-family: 'Poppins', sans-serif;"
                                >YV</span
                            >
                        </div>
                    </div>
                    <div>
                        <h3
                            class="font-bold text-lg text-gray-900"
                            style="font-family: 'Poppins', sans-serif;"
                        >
                            Yeshveer
                        </h3>
                        <p class="text-sm text-gray-500 font-medium">
                            yesh@college.edu
                        </p>
                    </div>
                </div>
            </div>

            <div class="flex-1 flex flex-col overflow-y-auto px-6 py-6">
                <nav class="space-y-2 flex-1">
                    <a
                        href="#"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 [&.active]:text-blue-600 [&.active]:bg-blue-50 [&.active]:font-bold [&.active]:border-l-4 [&.active]:border-blue-600 active"
                        data-page="discover"><span>Discover Events</span></a
                    >
                    <a
                        href="#"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 [&.active]:text-blue-600 [&.active]:bg-blue-50 [&.active]:font-bold [&.active]:border-l-4 [&.active]:border-blue-600"
                        data-page="myevents"><span>My Events</span></a
                    >
                    <a
                        href="#"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 [&.active]:text-blue-600 [&.active]:bg-blue-50 [&.active]:font-bold [&.active]:border-l-4 [&.active]:border-blue-600"
                        data-page="calendar"><span>Event Calendar</span></a
                    >
                    <a
                        href="#"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 [&.active]:text-blue-600 [&.active]:bg-blue-50 [&.active]:font-bold [&.active]:border-l-4 [&.active]:border-blue-600"
                        data-page="past"><span>Past Events</span></a
                    >
                    <a
                        href="#"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 [&.active]:text-blue-600 [&.active]:bg-blue-50 [&.active]:font-bold [&.active]:border-l-4 [&.active]:border-blue-600"
                        data-page="certificates"><span>Certificates</span></a
                    >
                    <a
                        href="#"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 [&.active]:text-blue-600 [&.active]:bg-blue-50 [&.active]:font-bold [&.active]:border-l-4 [&.active]:border-blue-600"
                        data-page="notifications"><span>Notifications</span></a
                    >
                    <a
                        href="#"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 [&.active]:text-blue-600 [&.active]:bg-blue-50 [&.active]:font-bold [&.active]:border-l-4 [&.active]:border-blue-600"
                        data-page="profile"><span>Profile</span></a
                    >
                    <a
                        href="/organiser"
                        id="organizerLink"
                        class="nav-link block px-4 py-3 text-gray-500 relative overflow-hidden transition-all hover:text-gray-800 hover:bg-gray-100 hover:translate-x-1 hidden"
                        ><span>Organizer Dashboard</span></a
                    >
                </nav>

                <div class="border-t border-gray-200 pt-4 mt-4">
                    <a href="/login" class="nav-link"><span>Logout</span></a>
                </div>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <Navbar dashboard={true} />

            <main class="flex-1 overflow-y-auto p-8 bg-gray-50">
                <div class="mb-6 lg:hidden">
                    <button
                        id="toggleSidebar"
                        class="text-gray-600 hover:text-gray-900 text-2xl"
                    >
                        ≡
                    </button>
                </div>
                <div id="discover-page" class="page-content">
                    <div class="flex justify-between items-center mb-8">
                        <h1
                            class="text-4xl font-black text-gray-900 tracking-tight uppercase"
                            style="font-family: 'Poppins', sans-serif;"
                        >
                            Discover Events
                        </h1>
                        <div class="flex gap-2">
                            <button
                                class="btn btn-sm btn-ghost text-lg hover:bg-gray-100"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                    ><path
                                        stroke-linecap="square"
                                        stroke-linejoin="miter"
                                        stroke-width="2"
                                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
                                    ></path></svg
                                >
                            </button>
                            <button
                                class="btn btn-sm btn-ghost text-lg hover:bg-gray-100"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                    ><path
                                        stroke-linecap="square"
                                        stroke-linejoin="miter"
                                        stroke-width="2"
                                        d="M4 6h16M4 12h16M4 18h16"></path></svg
                                >
                            </button>
                        </div>
                    </div>

                    <div
                        class="bg-white p-8 border-2 border-black mb-8 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"
                    >
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-5">
                            <input
                                type="text"
                                id="searchEvents"
                                placeholder="Search events..."
                                class="input input-bordered border-2 border-black focus:outline-none focus:ring-0 focus:border-blue-600 col-span-1 md:col-span-4 font-bold placeholder-gray-500"
                            />

                            <select
                                id="filterCategory"
                                class="select select-bordered border-2 border-black focus:outline-none focus:ring-0 focus:border-blue-600 font-bold"
                            >
                                <option disabled selected>Category</option>
                                <option>Technology</option>
                                <option>Cultural</option>
                                <option>Sports</option>
                                <option>Academic</option>
                            </select>

                            <input
                                type="date"
                                id="filterDate"
                                class="input input-bordered border-2 border-black focus:outline-none focus:ring-0 focus:border-blue-600 font-bold"
                            />

                            <select
                                id="filterVenue"
                                class="select select-bordered border-2 border-black focus:outline-none focus:ring-0 focus:border-blue-600 font-bold"
                            >
                                <option disabled selected>Location</option>
                                <option>Main Auditorium</option>
                                <option>Sports Complex</option>
                                <option>Online</option>
                            </select>

                            <button
                                class="btn btn-primary border-2 border-black bg-blue-600 hover:bg-blue-700 text-white font-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[1px] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all"
                                id="filterBtn"
                            >
                                FILTER
                            </button>
                        </div>
                    </div>

                    <div
                        id="eventsGrid"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                    >
                        <!-- Events will be loaded here dynamically -->
                        <div
                            class="col-span-full text-center py-10 text-gray-500"
                        >
                            Loading events...
                        </div>
                    </div>
                </div>

                <div id="myevents-page" class="page-content hidden">
                    <h1
                        class="text-4xl font-black text-gray-900 mb-8 tracking-tight"
                        style="font-family: 'Poppins', sans-serif;"
                    >
                        My Events
                    </h1>
                    <div
                        id="myEventsList"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                    >
                        <div
                            class="col-span-full text-center py-16 bg-white border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"
                        >
                            <p
                                class="text-gray-900 text-lg font-bold uppercase tracking-wider"
                                style="font-family: 'Poppins', sans-serif;"
                            >
                                Loading your events...
                            </p>
                        </div>
                    </div>
                </div>

                <div id="past-page" class="page-content hidden">
                    <h1
                        class="text-4xl font-black text-gray-900 mb-8 tracking-tight"
                        style="font-family: 'Poppins', sans-serif;"
                    >
                        Past Events
                    </h1>
                    <div
                        class="text-center py-16 bg-white shadow-lg border border-gray-200"
                    >
                        <p
                            class="text-gray-600 text-lg font-semibold"
                            style="font-family: 'Poppins', sans-serif;"
                        >
                            Your attended events will appear here
                        </p>
                    </div>
                </div>

                <div id="certificates-page" class="page-content hidden">
                    <h1
                        class="text-4xl font-black text-gray-900 mb-8 tracking-tight"
                        style="font-family: 'Poppins', sans-serif;"
                    >
                        Certificates & Achievements
                    </h1>
                    <div
                        class="text-center py-16 bg-white shadow-lg border border-gray-200"
                    >
                        <p
                            class="text-gray-600 text-lg font-semibold"
                            style="font-family: 'Poppins', sans-serif;"
                        >
                            Your certificates will appear here
                        </p>
                    </div>
                </div>

                <div id="notifications-page" class="page-content hidden">
                    <h1
                        class="text-4xl font-black text-gray-900 mb-8 tracking-tight"
                        style="font-family: 'Poppins', sans-serif;"
                    >
                        Notifications
                    </h1>
                    <div
                        class="text-center py-16 bg-white shadow-lg border border-gray-200"
                    >
                        <p
                            class="text-gray-600 text-lg font-semibold"
                            style="font-family: 'Poppins', sans-serif;"
                        >
                            No new notifications
                        </p>
                    </div>
                </div>

                <div id="notifications-page" class="page-content hidden">
                    <h1
                        class="text-4xl font-black text-gray-900 mb-8 tracking-tight uppercase"
                        style="font-family: 'Poppins', sans-serif;"
                    >
                        Notifications
                    </h1>
                    <div class="space-y-4">
                        <div
                            class="bg-white p-6 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] border-l-8 border-l-blue-600"
                        >
                            <h3
                                class="font-bold text-lg text-gray-900 uppercase"
                            >
                                Welcome to EventEase!
                            </h3>
                            <p class="text-gray-700 mt-2 font-medium">
                                Your account has been successfully created.
                                Explore events and start your journey.
                            </p>
                            <span
                                class="text-xs text-gray-500 mt-4 block font-bold uppercase tracking-wide"
                                >Just now</span
                            >
                        </div>
                        <!-- Mock notifications for now -->
                        <div
                            class="bg-white p-6 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] border-l-8 border-l-green-600"
                        >
                            <h3
                                class="font-bold text-lg text-gray-900 uppercase"
                            >
                                Profile Updated
                            </h3>
                            <p class="text-gray-700 mt-2 font-medium">
                                Your profile details have been updated
                                successfully.
                            </p>
                            <span
                                class="text-xs text-gray-500 mt-4 block font-bold uppercase tracking-wide"
                                >2 mins ago</span
                            >
                        </div>
                    </div>
                </div>

                <div id="profile-page" class="page-content hidden">
                    <h1
                        class="text-4xl font-black text-gray-900 mb-8 tracking-tight"
                        style="font-family: 'Poppins', sans-serif;"
                    >
                        Profile Settings
                    </h1>
                    <div
                        class="bg-white border-2 border-black p-8 max-w-2xl shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]"
                    >
                        <form id="profileForm" class="space-y-6">
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <label
                                        class="block text-sm font-black text-gray-900 mb-2 uppercase tracking-wide"
                                        >First Name</label
                                    >
                                    <input
                                        type="text"
                                        name="firstName"
                                        id="profileFirstName"
                                        class="input input-bordered w-full border-2 border-black focus:outline-none focus:ring-0 focus:border-blue-600 font-bold"
                                    />
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-black text-gray-900 mb-2 uppercase tracking-wide"
                                        >Last Name</label
                                    >
                                    <input
                                        type="text"
                                        name="lastName"
                                        id="profileLastName"
                                        class="input input-bordered w-full border-2 border-black focus:outline-none focus:ring-0 focus:border-blue-600 font-bold"
                                    />
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-black text-gray-900 mb-2 uppercase tracking-wide"
                                    >Email</label
                                >
                                <input
                                    type="email"
                                    name="email"
                                    id="profileEmail"
                                    class="input input-bordered w-full bg-gray-100 border-2 border-black font-bold text-gray-500"
                                    readonly
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-black text-gray-900 mb-2 uppercase tracking-wide"
                                    >Phone</label
                                >
                                <input
                                    type="tel"
                                    name="phone"
                                    id="profilePhone"
                                    class="input input-bordered w-full border-2 border-black focus:outline-none focus:ring-0 focus:border-blue-600 font-bold"
                                />
                            </div>

                            <div class="pt-4">
                                <button
                                    type="submit"
                                    class="btn btn-primary w-full border-2 border-black bg-blue-600 hover:bg-blue-700 text-white font-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[2px] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-all uppercase"
                                    >Update Profile</button
                                >
                            </div>
                        </form>
                    </div>
                </div>
            </main>

            <div
                id="sidebarOverlay"
                class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"
            >
            </div>

            <!-- Event Details Modal -->
            <dialog id="eventModal" class="modal backdrop-blur-sm">
                <div
                    class="modal-box w-11/12 max-w-3xl p-0 overflow-hidden bg-white border-4 border-black shadow-[12px_12px_0px_0px_rgba(0,0,0,1)] rounded-none"
                >
                    <div class="relative h-64 bg-blue-600">
                        <img
                            id="modalImage"
                            src=""
                            alt="Event"
                            class="w-full h-full object-cover opacity-80 grayscale mix-blend-multiply"
                        />
                        <div
                            class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"
                        >
                        </div>
                        <button
                            class="btn btn-square btn-sm absolute right-4 top-4 bg-white border-2 border-black text-black hover:bg-gray-200 rounded-none shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]"
                            onclick="eventModal.close()"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-6 w-6"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                                ><path
                                    stroke-linecap="square"
                                    stroke-linejoin="miter"
                                    stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path></svg
                            >
                        </button>
                        <div class="absolute bottom-6 left-6 text-white">
                            <span
                                id="modalCategory"
                                class="badge bg-blue-600 border-2 border-white text-white mb-2 font-bold uppercase tracking-wider rounded-none px-3 py-1"
                                >Category</span
                            >
                            <h2
                                id="modalTitle"
                                class="text-4xl font-black uppercase tracking-tight"
                            >
                                Event Title
                            </h2>
                        </div>
                    </div>
                    <div class="p-8">
                        <div class="flex flex-col md:flex-row gap-8 mb-8">
                            <div class="flex-1">
                                <h3
                                    class="text-xl font-black mb-4 uppercase tracking-wide border-b-4 border-black inline-block pb-1"
                                >
                                    Description
                                </h3>
                                <p
                                    id="modalDescription"
                                    class="text-gray-800 leading-relaxed font-medium text-lg"
                                >
                                    Event description goes here...
                                </p>
                                <p
                                    id="modalLongDescription"
                                    class="text-gray-700 leading-relaxed mt-4 whitespace-pre-line"
                                >
                                </p>

                                <div class="mt-8 grid grid-cols-2 gap-6">
                                    <div
                                        class="flex items-start gap-3 text-gray-900"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-6 w-6 mt-1"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                            ><path
                                                stroke-linecap="square"
                                                stroke-linejoin="miter"
                                                stroke-width="2"
                                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                                            ></path></svg
                                        >
                                        <div>
                                            <p
                                                class="text-xs text-gray-500 font-black uppercase tracking-wider"
                                            >
                                                DATE
                                            </p>
                                            <p
                                                id="modalDate"
                                                class="font-bold text-lg"
                                            >
                                                Dec 20, 2025
                                            </p>
                                        </div>
                                    </div>
                                    <div
                                        class="flex items-start gap-3 text-gray-900"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-6 w-6 mt-1"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                            ><path
                                                stroke-linecap="square"
                                                stroke-linejoin="miter"
                                                stroke-width="2"
                                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                            ></path></svg
                                        >
                                        <div>
                                            <p
                                                class="text-xs text-gray-500 font-black uppercase tracking-wider"
                                            >
                                                TIME
                                            </p>
                                            <p
                                                id="modalTime"
                                                class="font-bold text-lg"
                                            >
                                                10:00 AM
                                            </p>
                                        </div>
                                    </div>
                                    <div
                                        class="flex items-start gap-3 text-gray-900"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-6 w-6 mt-1"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                            ><path
                                                stroke-linecap="square"
                                                stroke-linejoin="miter"
                                                stroke-width="2"
                                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                                            ></path><path
                                                stroke-linecap="square"
                                                stroke-linejoin="miter"
                                                stroke-width="2"
                                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                                            ></path></svg
                                        >
                                        <div>
                                            <p
                                                class="text-xs text-gray-500 font-black uppercase tracking-wider"
                                            >
                                                LOCATION
                                            </p>
                                            <p
                                                id="modalVenue"
                                                class="font-bold text-lg"
                                            >
                                                Main Auditorium
                                            </p>
                                        </div>
                                    </div>
                                    <div
                                        class="flex items-start gap-3 text-gray-900"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="h-6 w-6 mt-1"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                            ><path
                                                stroke-linecap="square"
                                                stroke-linejoin="miter"
                                                stroke-width="2"
                                                d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"
                                            ></path></svg
                                        >
                                        <div>
                                            <p
                                                class="text-xs text-gray-500 font-black uppercase tracking-wider"
                                            >
                                                PRICE
                                            </p>
                                            <p
                                                id="modalPrice"
                                                class="font-bold text-lg"
                                            >
                                                Free
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="w-full md:w-72 bg-gray-50 p-6 border-2 border-black h-fit shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"
                            >
                                <h3
                                    class="font-black mb-4 uppercase tracking-wide"
                                >
                                    Organizer
                                </h3>
                                <div class="flex items-center gap-4 mb-6">
                                    <div class="avatar placeholder">
                                        <div
                                            class="bg-black text-white w-12 rounded-none border-2 border-black"
                                        >
                                            <span class="text-sm font-bold"
                                                >OR</span
                                            >
                                        </div>
                                    </div>
                                    <div>
                                        <p
                                            id="modalOrganizer"
                                            class="font-bold text-gray-900"
                                        >
                                            Organizer Name
                                        </p>
                                        <p
                                            class="text-xs text-gray-500 font-bold uppercase"
                                        >
                                            Event Organizer
                                        </p>
                                    </div>
                                </div>
                                <button
                                    id="registerBtn"
                                    class="btn btn-primary w-full border-2 border-black bg-black text-white hover:bg-gray-800 font-black uppercase tracking-wider shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[2px] transition-all rounded-none"
                                    >Register Now</button
                                >
                            </div>
                        </div>
                    </div>
                    <form
                        method="dialog"
                        class="modal-backdrop bg-black/50 backdrop-blur-sm"
                    >
                        <button>close</button>
                    </form>
                </div>
            </dialog>
        </div>

        <script>
            import api from "../lib/api";
            import { checkAuth } from "../lib/auth";

            document.addEventListener("DOMContentLoaded", async () => {
                const user = await checkAuth();
                if (!user) {
                    window.location.href = "/login";
                    return;
                }

                const sidebar = document.getElementById("sidebar");
                const sidebarOverlay =
                    document.getElementById("sidebarOverlay");
                const toggleSidebar = document.getElementById("toggleSidebar");
                const closeSidebar = document.getElementById("closeSidebar");
                const navLinks = document.querySelectorAll(
                    ".nav-link[data-page]",
                );
                const pages = document.querySelectorAll(".page-content");
                const currentPageBreadcrumb =
                    document.getElementById("currentPage");

                toggleSidebar?.addEventListener("click", () => {
                    sidebar?.classList.remove("-translate-x-full");
                    sidebarOverlay?.classList.remove("hidden");
                });

                closeSidebar?.addEventListener("click", () => {
                    sidebar?.classList.add("-translate-x-full");
                    sidebarOverlay?.classList.add("hidden");
                });

                sidebarOverlay?.addEventListener("click", () => {
                    sidebar?.classList.add("-translate-x-full");
                    sidebarOverlay?.classList.add("hidden");
                });

                navLinks.forEach((link) => {
                    link.addEventListener("click", (e) => {
                        e.preventDefault();

                        navLinks.forEach((l) => l.classList.remove("active"));
                        link.classList.add("active");

                        const pageId = (link as HTMLElement).dataset.page;
                        pages.forEach((page) => page.classList.add("hidden"));

                        const targetPage = document.getElementById(
                            `${pageId}-page`,
                        );
                        if (targetPage) {
                            targetPage.classList.remove("hidden");
                            const pageTitle = link.textContent.trim();
                            if (currentPageBreadcrumb) {
                                currentPageBreadcrumb.textContent = pageTitle;
                            }

                            if (pageId === "discover") fetchEvents();
                            if (pageId === "myevents") fetchMyEvents();
                        }

                        if (window.innerWidth < 1024) {
                            sidebar?.classList.add("-translate-x-full");
                            sidebarOverlay?.classList.add("hidden");
                        }
                    });
                });

                async function fetchUserProfile() {
                    try {
                        const res = await api.get("/api/user/me");
                        if (res.status === 200) {
                            const { data } = res.data;
                            const firstNameInput = document.getElementById(
                                "profileFirstName",
                            ) as HTMLInputElement;
                            const lastNameInput = document.getElementById(
                                "profileLastName",
                            ) as HTMLInputElement;
                            const emailInput = document.getElementById(
                                "profileEmail",
                            ) as HTMLInputElement;
                            const phoneInput = document.getElementById(
                                "profilePhone",
                            ) as HTMLInputElement;

                            if (firstNameInput)
                                firstNameInput.value = data.firstName || "";
                            if (lastNameInput)
                                lastNameInput.value = data.lastName || "";
                            if (emailInput) emailInput.value = data.email || "";
                            if (phoneInput) phoneInput.value = data.phone || "";

                            const userNameElements = document.querySelectorAll(
                                ".user-name, h3.font-bold.text-lg.text-gray-900",
                            );
                            userNameElements.forEach(
                                (el) =>
                                    (el.textContent = `${data.firstName} ${data.lastName}`),
                            );

                            const initials =
                                `${data.firstName[0]}${data.lastName[0]}`.toUpperCase();
                            document
                                .querySelectorAll(".avatar span")
                                .forEach((el) => (el.textContent = initials));

                            if (
                                data.role === "ORGANIZER" ||
                                data.role === "BOTH"
                            ) {
                                document
                                    .getElementById("organizerLink")
                                    ?.classList.remove("hidden");
                            }
                        }
                    } catch (e) {
                        console.error("Failed to fetch profile", e);
                    }
                }

                const profileForm = document.getElementById("profileForm");
                profileForm?.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target as HTMLFormElement);
                    const data = Object.fromEntries(formData.entries());

                    try {
                        const res = await api.put("/api/user/update", data);
                        if (res.status === 200) {
                            alert("Profile updated successfully!");
                            fetchUserProfile();
                        } else {
                            alert("Failed to update profile");
                        }
                    } catch (e) {
                        console.error(e);
                        alert("Error updating profile");
                    }
                });

                async function fetchEvents(params = {}) {
                    const grid = document.getElementById("eventsGrid");
                    if (!grid) return;
                    grid.innerHTML =
                        '<div class="col-span-full text-center py-10 text-gray-500">Loading events...</div>';

                    try {
                        const query = new URLSearchParams(params).toString();
                        const res = await api.get(`/api/event/?${query}`);
                        const { events } = res.data;

                        if (events.length === 0) {
                            grid.innerHTML =
                                '<div class="col-span-full text-center py-10 text-gray-500">No upcoming events found.</div>';
                            return;
                        }

                        grid.innerHTML = events
                            .map(
                                (event) => `
                <div class="card bg-white border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] transition-all hover:-translate-y-1 overflow-hidden rounded-none">
                  <figure class="h-48 bg-gray-200 relative border-b-2 border-black">
                    <img src="${event.posterUrl || "https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1770&q=80"}" class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-500" />
                    <div class="absolute top-4 right-4">
                        <span class="badge bg-white text-black border-2 border-black font-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] uppercase tracking-wider rounded-none">${event.category}</span>
                    </div>
                  </figure>
                  <div class="card-body p-6">
                    <h2 class="card-title text-xl font-black text-gray-900 mb-2 line-clamp-1 uppercase tracking-tight">${event.title}</h2>
                    <div class="space-y-2 text-sm text-gray-700 mb-6 font-medium">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        ${new Date(event.date).toLocaleDateString()}
                      </div>
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                        ${event.venue}
                      </div>
                    </div>
                    <div class="card-actions justify-between items-center mt-auto pt-4 border-t-2 border-gray-100">
                      <span class="font-black text-xl text-blue-600">${event.price > 0 ? "$" + event.price : "Free"}</span>
                      <button class="btn btn-primary btn-sm font-bold border-2 border-black bg-black text-white hover:bg-gray-800 shadow-[2px_2px_0px_0px_rgba(0,0,0,0.5)] rounded-none uppercase tracking-wide" onclick="openEventModal('${event.publicId}')">View Details</button>
                    </div>
                  </div>
                </div>
            `,
                            )
                            .join("");
                    } catch (e) {
                        console.error(e);
                        grid.innerHTML =
                            '<div class="col-span-full text-center py-10 text-red-500">Failed to load events.</div>';
                    }
                }

                (window as any).openEventModal = async (id) => {
                    try {
                        const res = await api.get(`/api/event/${id}`);
                        const { event: data } = res.data;

                        const modal = document.getElementById(
                            "eventModal",
                        ) as HTMLDialogElement;
                        document.getElementById("modalTitle")!.textContent =
                            data.title;
                        document.getElementById("modalCategory")!.textContent =
                            data.category;
                        document.getElementById(
                            "modalDescription",
                        )!.textContent = data.description;
                        document.getElementById(
                            "modalLongDescription",
                        )!.textContent = data.longDescription || "";
                        document.getElementById("modalDate")!.textContent =
                            new Date(data.date).toLocaleDateString();
                        document.getElementById("modalTime")!.textContent =
                            new Date(data.startTime).toLocaleTimeString([], {
                                hour: "2-digit",
                                minute: "2-digit",
                            });
                        document.getElementById("modalVenue")!.textContent =
                            data.venue;
                        document.getElementById("modalPrice")!.textContent =
                            data.price > 0 ? `$${data.price}` : "Free";
                        document.getElementById("modalOrganizer")!.textContent =
                            `${data.organizer.firstName} ${data.organizer.lastName}`;
                        (
                            document.getElementById(
                                "modalImage",
                            ) as HTMLImageElement
                        ).src =
                            data.posterUrl ||
                            "https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1770&q=80";

                        const registerBtn =
                            document.getElementById("registerBtn");
                        registerBtn!.onclick = () => registerForEvent(id);

                        modal.showModal();
                    } catch (e) {
                        console.error(e);
                    }
                };

                async function registerForEvent(id) {
                    try {
                        const res = await api.post(
                            "/api/registration/register",
                            {
                                eventId: id,
                            },
                        );
                        const result = res.data;
                        if (res.status === 200 || res.status === 201) {
                            alert("Successfully registered!");
                            (
                                document.getElementById(
                                    "eventModal",
                                ) as HTMLDialogElement
                            ).close();
                            fetchMyEvents();
                        } else {
                            alert(result.message || "Registration failed");
                        }
                    } catch (e) {
                        console.error(e);
                        const message =
                            e.response?.data?.message ||
                            "Error registering for event";
                        alert(message);
                    }
                }

                async function fetchMyEvents() {
                    const list = document.getElementById("myEventsList");
                    if (!list) return;

                    try {
                        const res = await api.get("/api/registration/my");
                        const { data } = res.data;

                        if (data.length === 0) {
                            list.innerHTML =
                                '<div class="col-span-full text-center py-16 bg-white shadow-lg border border-gray-200"><p class="text-gray-600 text-lg font-semibold">You haven\'t registered for any events yet.</p></div>';
                            return;
                        }

                        list.innerHTML = data
                            .map(
                                (reg) => `
                <div class="card bg-white border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] rounded-none">
                    <div class="card-body">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-black text-lg text-gray-900 uppercase tracking-tight">${reg.event.title}</h3>
                                <p class="text-sm text-gray-600 font-bold mt-1">${new Date(reg.event.date).toLocaleDateString()}</p>
                            </div>
                            <span class="badge ${reg.paymentStatus === "COMPLETED" ? "bg-green-500" : "bg-yellow-500"} text-white text-xs font-black border-2 border-black rounded-none uppercase tracking-wide">${reg.paymentStatus}</span>
                        </div>
                        <div class="mt-4 pt-4 border-t-2 border-gray-100 flex justify-between items-center">
                            <div class="text-xs text-gray-500 font-mono font-bold">ID: ${reg.ticketId}</div>
                            <button class="btn btn-ghost btn-xs text-blue-600 font-bold hover:bg-blue-50 rounded-none uppercase">View Ticket</button>
                        </div>
                    </div>
                </div>
            `,
                            )
                            .join("");
                    } catch (e) {
                        console.error(e);
                    }
                }

                const filterBtn = document.getElementById("filterBtn");
                filterBtn?.addEventListener("click", () => {
                    const search = (
                        document.getElementById(
                            "searchEvents",
                        ) as HTMLInputElement
                    ).value;
                    const category = (
                        document.getElementById(
                            "filterCategory",
                        ) as HTMLSelectElement
                    ).value;
                    const date = (
                        document.getElementById(
                            "filterDate",
                        ) as HTMLInputElement
                    ).value;
                    const venue = (
                        document.getElementById(
                            "filterVenue",
                        ) as HTMLSelectElement
                    ).value;

                    const params: any = {};
                    if (search) params.search = search;
                    if (category && category !== "Category")
                        params.category = category;
                    if (date) params.date = date;
                    if (venue && venue !== "Location") params.venue = venue;

                    fetchEvents(params);
                });

                fetchUserProfile();
                fetchEvents();
            });
        </script>

        <style>
            * {
                border-radius: 0 !important;
            }

            .btn,
            .card,
            .input,
            .select,
            .badge,
            .modal-box {
                border-radius: 0 !important;
            }

            .nav-link {
                display: block;
                padding: 0.75rem 1rem;
                color: rgb(107, 114, 128);
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .nav-link::before {
                content: "";
                position: absolute;
                left: 0;
                top: 0;
                height: 100%;
                width: 3px;
                background: rgb(59, 130, 246);
                transform: scaleY(0);
                transition: transform 0.3s ease;
            }

            .nav-link:hover {
                color: rgb(31, 41, 55);
                background: rgb(243, 244, 246);
                transform: translateX(4px);
            }

            .nav-link.active {
                color: rgb(37, 99, 235);
                background: rgb(239, 246, 255);
                font-weight: 700;
            }

            .nav-link.active::before {
                transform: scaleY(1);
            }

            .page-content {
                animation: fadeIn 0.3s ease-in;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        </style>
    </div>
</Layout>
