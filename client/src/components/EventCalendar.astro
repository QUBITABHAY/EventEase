---
// EventCalendar.astro - Google Calendar style event calendar
---

<div class="bg-white shadow-lg border border-gray-200 h-full">
  <!-- Calendar Header -->
  <div class="border-b border-gray-200 p-4 bg-gray-50">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-4">
        <h2 class="text-2xl font-black text-gray-900">
          <span id="current-month">December</span> <span id="current-year">2025</span>
        </h2>
      </div>
      <div class="flex items-center gap-2">
        <button id="prev-month" class="px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 transition-colors font-semibold text-gray-700">
          ‹ Prev
        </button>
        <button id="today-btn" class="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 transition-colors font-semibold">
          Today
        </button>
        <button id="next-month" class="px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 transition-colors font-semibold text-gray-700">
          Next ›
        </button>
      </div>
    </div>
    
    <!-- View Toggle -->
    <div class="flex gap-2">
      <button class="view-toggle active px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 transition-colors font-semibold" data-view="month">
        Month
      </button>
      <button class="view-toggle px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 transition-colors font-semibold text-gray-700" data-view="week">
        Week
      </button>
      <button class="view-toggle px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 transition-colors font-semibold text-gray-700" data-view="day">
        Day
      </button>
    </div>
  </div>

  <!-- Calendar Grid -->
  <div id="calendar-view" class="p-4">
    <!-- Day Names Header -->
    <div class="grid grid-cols-7 gap-px mb-px bg-gray-200">
      <div class="bg-gray-50 p-3 text-center font-bold text-gray-700 text-sm">SUN</div>
      <div class="bg-gray-50 p-3 text-center font-bold text-gray-700 text-sm">MON</div>
      <div class="bg-gray-50 p-3 text-center font-bold text-gray-700 text-sm">TUE</div>
      <div class="bg-gray-50 p-3 text-center font-bold text-gray-700 text-sm">WED</div>
      <div class="bg-gray-50 p-3 text-center font-bold text-gray-700 text-sm">THU</div>
      <div class="bg-gray-50 p-3 text-center font-bold text-gray-700 text-sm">FRI</div>
      <div class="bg-gray-50 p-3 text-center font-bold text-gray-700 text-sm">SAT</div>
    </div>

    <!-- Calendar Days Grid -->
    <div id="calendar-days" class="grid grid-cols-7 gap-px bg-gray-200 min-h-[600px]">
      <!-- Days will be populated by JavaScript -->
    </div>
  </div>
</div>

<!-- Event Modal -->
<div id="event-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 backdrop-blur-sm">
  <div class="bg-white w-full max-w-2xl shadow-2xl border border-gray-300">
    <div class="bg-blue-600 text-white p-6 flex justify-between items-center">
      <h3 class="text-2xl font-black">Event Details</h3>
      <button id="close-modal" class="text-white hover:text-gray-200 text-3xl font-bold">×</button>
    </div>
    <div id="modal-content" class="p-6">
      <!-- Event details will be populated here -->
    </div>
  </div>
</div>

<script>
  // Sample event data
  const events = [
    {
      id: 1,
      title: "Tech Conference 2025",
      date: "2025-12-20",
      time: "10:00 AM",
      location: "Main Auditorium",
      description: "Annual technology summit featuring industry leaders",
      category: "Technology",
      color: "bg-blue-500"
    },
    {
      id: 2,
      title: "AI Workshop",
      date: "2025-12-15",
      time: "2:00 PM",
      location: "Lab 301",
      description: "Hands-on workshop on AI and Machine Learning",
      category: "Technology",
      color: "bg-purple-500"
    },
    {
      id: 3,
      title: "Cultural Fest",
      date: "2025-12-25",
      time: "6:00 PM",
      location: "Open Grounds",
      description: "Annual cultural celebration with performances",
      category: "Cultural",
      color: "bg-pink-500"
    },
    {
      id: 4,
      title: "Hackathon 2025",
      date: "2025-12-18",
      time: "9:00 AM",
      location: "Computer Lab",
      description: "24-hour coding competition",
      category: "Technology",
      color: "bg-green-500"
    },
    {
      id: 5,
      title: "Sports Day",
      date: "2025-12-22",
      time: "8:00 AM",
      location: "Sports Complex",
      description: "Annual sports competition",
      category: "Sports",
      color: "bg-orange-500"
    }
  ];

  let currentDate = new Date();
  let currentView = 'month';

  function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    // Update header
    const monthNames = ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    const monthElement = document.getElementById('current-month');
    const yearElement = document.getElementById('current-year');
    if (monthElement) {
      monthElement.textContent = monthNames[month];
    }
    if (yearElement) {
      yearElement.textContent = year.toString();
    }

    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();

    const calendarDays = document.getElementById('calendar-days');
    if (!calendarDays) return;
    calendarDays.innerHTML = '';

    // Previous month days
    for (let i = firstDay - 1; i >= 0; i--) {
      const dayDiv = createDayCell(daysInPrevMonth - i, true, year, month - 1);
      calendarDays.appendChild(dayDiv);
    }

    // Current month days
    for (let day = 1; day <= daysInMonth; day++) {
      const dayDiv = createDayCell(day, false, year, month);
      calendarDays.appendChild(dayDiv);
    }

    // Next month days to complete the grid
    const totalCells = firstDay + daysInMonth;
    const weeksNeeded = Math.ceil(totalCells / 7);
    const remainingCells = (weeksNeeded * 7) - totalCells;
    for (let day = 1; day <= remainingCells; day++) {
      const dayDiv = createDayCell(day, true, year, month + 1);
      calendarDays.appendChild(dayDiv);
    }
  }

  function createDayCell(day, isOtherMonth, year, month) {
    const dayDiv = document.createElement('div');
    dayDiv.className = `bg-white p-2 min-h-[100px] border-gray-200 hover:bg-gray-50 transition-colors ${isOtherMonth ? 'text-gray-400' : 'text-gray-900'}`;
    
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const today = new Date();
    const isToday = dateStr === `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
    
    const dayNumber = document.createElement('div');
    dayNumber.className = `text-sm font-bold mb-1 ${isToday ? 'bg-blue-600 text-white w-7 h-7 flex items-center justify-center' : ''}`;
    dayNumber.style.fontFamily = "'Poppins', sans-serif";
    dayNumber.textContent = day;
    dayDiv.appendChild(dayNumber);

    // Add events for this day
    const dayEvents = events.filter(event => event.date === dateStr);
    dayEvents.forEach(event => {
      const eventDiv = document.createElement('div');
      eventDiv.className = `${event.color} text-white text-xs p-1 mb-1 cursor-pointer hover:opacity-80 transition-opacity`;
      eventDiv.textContent = event.title;
      eventDiv.onclick = () => showEventModal(event);
      dayDiv.appendChild(eventDiv);
    });

    return dayDiv;
  }

  function showEventModal(event) {
    const modal = document.getElementById('event-modal');
    const modalContent = document.getElementById('modal-content');
    
    if (!modalContent || !modal) return;
    
    modalContent.innerHTML = `
      <div class="space-y-4">
        <div>
          <h4 class="text-2xl font-black text-gray-900 mb-2">${event.title}</h4>
          <span class="inline-block px-3 py-1 ${event.color} text-white text-sm font-bold">${event.category}</span>
        </div>
        <div class="space-y-2">
          <p class="text-gray-700"><span class="font-bold">Date:</span> ${new Date(event.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
          <p class="text-gray-700"><span class="font-bold">Time:</span> ${event.time}</p>
          <p class="text-gray-700"><span class="font-bold">Location:</span> ${event.location}</p>
        </div>
        <div>
          <p class="text-gray-700 font-semibold">Description:</p>
          <p class="text-gray-600">${event.description}</p>
        </div>
        <div class="flex gap-3 mt-6">
          <button class="px-6 py-3 bg-blue-600 text-white font-bold hover:bg-blue-700 transition-colors flex-1">Register</button>
          <button class="px-6 py-3 bg-white border-2 border-gray-300 text-gray-700 font-bold hover:bg-gray-50 transition-colors flex-1">Share</button>
        </div>
      </div>
    `;
    
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  // Event listeners
  document.getElementById('prev-month')?.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  document.getElementById('next-month')?.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  document.getElementById('today-btn')?.addEventListener('click', () => {
    currentDate = new Date();
    renderCalendar();
  });

  document.getElementById('close-modal')?.addEventListener('click', () => {
    const modal = document.getElementById('event-modal');
    if (!modal) return;
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  });

  // View toggle buttons
  document.querySelectorAll('.view-toggle').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.view-toggle').forEach(b => {
        b.classList.remove('active', 'bg-blue-600', 'text-white');
        b.classList.add('bg-white', 'border', 'border-gray-300', 'text-gray-700');
      });
      btn.classList.add('active', 'bg-blue-600', 'text-white');
      btn.classList.remove('bg-white', 'border', 'border-gray-300', 'text-gray-700');
      currentView = (btn as HTMLButtonElement).dataset.view || 'month';
      // View switching logic can be implemented here
    });
  });

  // Initial render
  renderCalendar();
</script>


